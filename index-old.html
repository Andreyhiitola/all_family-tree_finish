<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–°–µ–º–µ–π–Ω–æ–µ –¥—Ä–µ–≤–æ</title>
  <meta name="viewport" content="width=device-width">
  <style>
    body { margin: 0; font-family: system-ui; background: #f0f4f8; }
    .app { display: flex; height: 100vh; }
    #tree-svg { flex: 1; background: white; }
    .controls { position: fixed; top: 10px; left: 10px; background: white; padding: 10px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    button { margin: 2px; padding: 6px 12px; border: none; border-radius: 4px; background: #3498db; color: white; cursor: pointer; }
    .node { stroke: #000; stroke-width: 2; }
    .node-male { fill: #a4d0f7; }
    .node-female { fill: #f7a4d0; }
    .link { fill: none; stroke: #666; stroke-width: 2; stroke-opacity: 0.6; }
    .person-node { cursor: pointer; }
    .person-node:hover { transform: scale(1.1); }
  </style>
</head>
<body>
  <div class="app">
    <svg id="tree-svg"></svg>
    <div class="controls">
      <button onclick="addPerson()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
      <button onclick="clearData()">üóë –û—á–∏—Å—Ç–∏—Ç—å</button>
      <span id="stats">üë• 6 —á–µ–ª–æ–≤–µ–∫</span>
    </div>
  </div>

  <script>
    // ‚úÖ –î–ï–ú–û –î–ê–ù–ù–´–ï –í –öODE
    const PEOPLE = [
      {"id":1,"name":"–ò–≤–∞–Ω","surname":"–ò–≤–∞–Ω–æ–≤","gender":"M"},
      {"id":2,"name":"–ú–∞—Ä–∏—è","surname":"–ü–µ—Ç—Ä–æ–≤–∞","gender":"F","spouseId":1},
      {"id":3,"name":"–ü—ë—Ç—Ä","surname":"–ò–≤–∞–Ω–æ–≤","gender":"M","fatherId":1},
      {"id":4,"name":"–ê–Ω–Ω–∞","surname":"–°–∏–¥–æ—Ä–æ–≤–∞","gender":"F","spouseId":3},
      {"id":5,"name":"–ê–ª–µ–∫—Å–µ–π","surname":"–ò–≤–∞–Ω–æ–≤","gender":"M","fatherId":3},
      {"id":6,"name":"–ï–ª–µ–Ω–∞","surname":"–ö—É–∑–Ω–µ—Ü–æ–≤–∞","gender":"F","spouseId":5}
    ];

    let currentRootId = 1;

    // TreeVisualizer
    const svg = d3.select("#tree-svg");
    const g = svg.append("g");
    svg.call(d3.zoom().on("zoom", e => g.attr("transform", e.transform)));

    function renderTree(rootId) {
      console.log("üé® –†–ï–ù–î–ï–†:", rootId);
      
      // –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞
      function buildTree(id) {
        const person = PEOPLE.find(p => p.id === id);
        if (!person) return null;
        const children = PEOPLE.filter(p => p.fatherId === id);
        return {
          data: person,
          children: children.map(c => buildTree(c.id)).filter(Boolean)
        };
      }
      
      const treeData = buildTree(rootId);
      const hierarchy = d3.hierarchy(treeData);
      const treeLayout = d3.tree().size([600, 800]);
      const root = treeLayout(hierarchy);
      
      // –û—á–∏—Å—Ç–∫–∞
      g.selectAll("*").remove();
      
      // –õ–∏–Ω–∏–∏
      g.append("g").attr("class", "links")
        .selectAll("path")
        .data(root.links())
        .enter().append("path")
        .attr("class", "link")
        .attr("d", d3.linkHorizontal()
          .x(d => d.y)
          .y(d => d.x));
      
      // –£–∑–ª—ã
      g.append("g").attr("class", "nodes")
        .selectAll("g")
        .data(root.descendants())
        .enter().append("g")
        .attr("class", "person-node")
        .attr("transform", d => `translate(${d.y},${d.x})`)
        .on("click", (event, d) => {
          console.log("üñ± –ö–õ–ò–ö:", d.data.data.name);
          currentRootId = d.data.data.id;
          renderTree(currentRootId);
        })
        .append("circle")
        .attr("r", 30)
        .attr("class", d => `node node-${d.data.data.gender}`)
        .attr("stroke", "#000")
        .attr("stroke-width", 2)
        .each(function(d) {
          const g = d3.select(this.parentNode);
          g.append("text")
            .attr("dy", -8)
            .attr("text-anchor", "middle")
            .style("font-weight", "bold")
            .style("font-size", "12px")
            .style("fill", "#000")
            .text(d.data.data.name);
          g.append("text")
            .attr("dy", 8)
            .attr("text-anchor", "middle")
            .style("font-size", "11px")
            .style("fill", "#000")
            .text(d.data.data.surname);
        });
      
      document.getElementById("stats").textContent = `üë• ${PEOPLE.length} —á–µ–ª–æ–≤–µ–∫`;
    }

    // –°—Ç–∞—Ä—Ç
    renderTree(1);
    console.log("‚úÖ –ü–†–ò–õ–û–ñ–ï–ù–ò–ï –†–ê–ë–û–¢–ê–ï–¢!");
  </script>
</body>
</html>
