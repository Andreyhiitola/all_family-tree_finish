<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–°–µ–º–µ–π–Ω–æ–µ –¥—Ä–µ–≤–æ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <base href="/all_family-tree_finish/">  <!-- ‚Üê –°–Æ–î–ê —Å—Ç—Ä–æ–∫–∞ 6 --> 
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="app-header">
    <h1>–°–µ–º–µ–π–Ω–æ–µ –¥—Ä–µ–≤–æ</h1>
    <div class="header-controls">
      <button id="add-person">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
      <button id="show-data-table">üìã –¢–∞–±–ª–∏—Ü–∞</button>
      <button id="import-excel">üì• Excel-import</button>
      <button id="export-excel">üì§ Excel-export</button>
      <button class="btn" onclick="window.refreshTreeData()">üîÑ –†–µ—Ñ—Ä–µ—à</button>
      <label class="btn">
       üìÑ –ò–º–ø–æ—Ä—Ç JSON
  <input type="file" accept=".json" onchange="window.importJsonFile(event)" hidden>
</label>
<button class="btn" onclick="window.exportJsonFile()">üíæ –≠–∫—Å–ø–æ—Ä—Ç JSON</button>

      <button id="clear-data">üóë –û—á–∏—Å—Ç–∏—Ç—å</button>
      <input id="search" placeholder="üîç –ü–æ–∏—Å–∫...">
    </div>
  </header>

  <main class="app-main">
    <section class="tree-section">
      <div class="tree-container">
        <svg id="tree-svg" width="1200" height="800"></svg>
      </div>
      <div id="auto-save-status">üíæ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</div>
    </section>

    <aside class="info-panel">
      <div class="info-placeholder">üëÜ –ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ —á–µ–ª–æ–≤–µ–∫—É</div>
      <div class="person-details" style="display:none">
        <h2>
            <span data-field="name"></span> 
            <span data-field="surname"></span>
        </h2>
        
        <p><strong>–ü–æ–ª:</strong> <span data-field="gender"></span></p>
        <p><strong>–û—Ç—á–µ—Å—Ç–≤–æ:</strong> <span data-field="middlename"></span></p>
        <p><strong>–†–æ–¥–∏–ª—Å—è:</strong> <span data-field="birthDate"></span></p>
        <p><strong>–£–º–µ—Ä:</strong> <span data-field="deathDate"></span></p>
        <p><strong>–ú–µ—Å—Ç–æ:</strong> <span data-field="birthPlace"></span></p>
        <p><strong>–ë–∏–æ–≥—Ä–∞—Ñ–∏—è:</strong> <span data-field="biography"></span></p>

        <div class="person-actions">
          <button id="edit-person">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
          <button id="delete-person">üóë –£–¥–∞–ª–∏—Ç—å</button>
        </div>
      </div>

      <div class="stats">
        <p>üë• –í—Å–µ–≥–æ: <span id="total-people">0</span></p>
      </div>
    </aside>
  </main>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
  <div id="person-modal" class="modal">
    <div class="modal-content">
      <span class="close" id="cancel-form">&times;</span>
      <h2 id="modal-title">–ü–µ—Ä—Å–æ–Ω–∞</h2>
      <form id="person-form">
        <input type="hidden" id="form-id">
        
        <div class="form-row">
          <label>–ò–º—è:</label>
          <input type="text" id="form-name" required>
        </div>
        <div class="form-row">
          <label>–§–∞–º–∏–ª–∏—è:</label>
          <input type="text" id="form-surname" required>
        </div>
        <div class="form-row">
          <label>–û—Ç—á–µ—Å—Ç–≤–æ:</label>
          <input type="text" id="form-middlename">
        </div>
        <div class="form-row">
          <label>–ü–æ–ª:</label>
          <select id="form-gender">
            <option value="M">–ú—É–∂—Å–∫–æ–π</option>
            <option value="F">–ñ–µ–Ω—Å–∫–∏–π</option>
          </select>
        </div>
        <div class="form-row">
          <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</label>
          <input type="date" id="form-birthDate">
        </div>
        <div class="form-row">
          <label>–î–∞—Ç–∞ —Å–º–µ—Ä—Ç–∏:</label>
          <input type="date" id="form-deathDate">
        </div>
        <div class="form-row">
          <label>–ú–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è:</label>
          <input type="text" id="form-birthPlace">
        </div>
        
        <!-- –°–≤—è–∑–∏ -->
        <div class="form-row">
            <label>–û—Ç–µ—Ü:</label>
            <select id="form-father"><option value="">–ù–µ—Ç</option></select>
        </div>
        <div class="form-row">
            <label>–ú–∞—Ç—å:</label>
            <select id="form-mother"><option value="">–ù–µ—Ç</option></select>
        </div>
        <div class="form-row">
            <label>–°—É–ø—Ä—É–≥(–∞):</label>
            <select id="form-spouse"><option value="">–ù–µ—Ç</option></select>
        </div>

        <!-- –§–æ—Ç–æ –∏ –±–∏–æ–≥—Ä–∞—Ñ–∏—è -->
        <div class="form-row">
          <label>URL –∞–≤–∞—Ç–∞—Ä–∞:</label>
          <input type="url" id="form-photo" placeholder="https://example.com/photo.jpg –∏–ª–∏ photos/avatars/1.jpg">
          <small style="color:#666; font-size:11px;">–£–∫–∞–∂–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –ø—É—Ç—å –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Ñ–∞–π–ª—É</small>
        </div>
        
        <div class="form-row">
          <label>–ë–∏–æ–≥—Ä–∞—Ñ–∏—è:</label>
          <textarea id="form-biography" rows="4" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —á–µ–ª–æ–≤–µ–∫–µ..."></textarea>
        </div>

        <div class="form-row">
          <label>–ì–∞–ª–µ—Ä–µ—è —Ñ–æ—Ç–æ (URLs —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):</label>
          <textarea id="form-photos" rows="2" placeholder="https://example.com/1.jpg, photos/gallery/1-1.jpg, photos/gallery/1-2.jpg"></textarea>
          <small style="color:#666; font-size:11px;">–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –≤–Ω–µ—à–Ω–∏–µ URL, —Ç–∞–∫ –∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏</small>
        </div>

        <div class="form-buttons">
            <button type="submit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button type="button" id="cancel-form-btn" style="background:#999;">‚ùå –û—Ç–º–µ–Ω–∞</button>
        </div>
      </form>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¢–∞–±–ª–∏—Ü—ã -->
  <div id="data-table-modal" class="modal">
    <div class="modal-content modal-large">
        <span class="close">&times;</span>
        <h2>–¢–∞–±–ª–∏—Ü–∞ –¥–∞–Ω–Ω—ã—Ö</h2>
        <div style="overflow:auto; max-height:400px;">
            <table id="data-table">
                <thead>
                    <tr>
                        <th>ID</th><th>–ò–º—è</th><th>–§–∞–º–∏–ª–∏—è</th><th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ò–º–ø–æ—Ä—Ç–∞ -->
  <div id="import-modal" class="modal">
      <div class="modal-content">
          <span class="close" id="cancel-import">&times;</span>
          <h2>–ò–º–ø–æ—Ä—Ç Excel</h2>
          <input type="file" id="excel-file" accept=".xlsx, .xls">
      </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –£–¥–∞–ª–µ–Ω–∏—è -->
  <div id="delete-modal" class="modal">
      <div class="modal-content">
          <span class="close" id="cancel-delete">&times;</span>
          <h2>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h2>
          <p id="delete-message">–í—ã —É–≤–µ—Ä–µ–Ω—ã?</p>
          <button id="confirm-delete" style="background:red; color:white;">üóë –£–¥–∞–ª–∏—Ç—å</button>
      </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ü—Ä–æ—Ñ–∏–ª—è -->
  <div id="profile-modal" class="modal">
    <div class="modal-content modal-large">
      <span class="close" id="close-profile">&times;</span>
      
      <div class="profile-container">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ê–≤–∞—Ç–∞—Ä –∏ –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ -->
        <div class="profile-left">
          <img id="profile-avatar" src="https://via.placeholder.com/200?text=No+Photo" alt="–§–æ—Ç–æ" class="profile-avatar">
          <h2 id="profile-name">–ò–º—è –§–∞–º–∏–ª–∏—è</h2>
          <p id="profile-dates"></p>
          <p id="profile-place"></p>
        </div>
        
        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ë–∏–æ–≥—Ä–∞—Ñ–∏—è –∏ –≥–∞–ª–µ—Ä–µ—è -->
        <div class="profile-right">
          <h3>–ë–∏–æ–≥—Ä–∞—Ñ–∏—è</h3>
          <div id="profile-biography" class="profile-bio">–ë–∏–æ–≥—Ä–∞—Ñ–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞.</div>
          
          <h3>–ì–∞–ª–µ—Ä–µ—è —Ñ–æ—Ç–æ</h3>
          <div id="profile-gallery" class="profile-gallery">
            <p style="color:#999;">–ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–æ—Ç–æ</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- –°–∫—Ä–∏–ø—Ç—ã -->
  <script src="d3.v7.min.js"></script>
  <script src="xlsx.full.min.js"></script>
  <script src="FileSaver.min.js"></script>
<script src="src/utils/dataStorage.js"></script>

  <script src="src/core/DataManager.js"></script>
  <script src="src/core/FamilyTree.js"></script>
  <script src="src/core/TreeVisualizer.js"></script>
  <script src="src/utils/importExcel.js"></script>
  <script src="src/utils/exportExcel.js"></script>
  <script src="src/ui/notifications.js"></script>
  <script src="src/ui/forms.js"></script>
  <script src="src/ui/table.js"></script>
  <script src="src/ui/modals.js"></script>
  <script src="src/ui/app.js"></script>
  <script>
window.importJsonFile = function(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const data = JSON.parse(e.target.result);
      localStorage.setItem("familyTreeData", JSON.stringify(data));
      if (typeof window.loadPeople === "function") window.loadPeople();
      if (typeof window.refreshAll === "function") window.refreshAll();
      alert(`‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${data.length} –∑–∞–ø–∏—Å–µ–π`);
    } catch (error) {
      alert("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π JSON");
    }
  };
  reader.readAsText(file);
};

window.exportJsonFile = function() {
  const data = JSON.parse(localStorage.getItem("familyTreeData") || "[]");
  const blob = new Blob([JSON.stringify(data, null, 2)], {type: "application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `family-tree-${new Date().toISOString().split("T")[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
  console.log(`‚úÖ –≠–∫—Å–ø–æ—Ä—Ç JSON: ${data.length} –∑–∞–ø–∏—Å–µ–π`);
};
console.log("‚úÖ JSON —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!");
</script>
<script>
// üîÑ –ê–í–¢–û–ó–ê–ì–†–£–ó–ö–ê family-data.json
console.log("üîÑ –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞...");

(async function autoLoad() {
  const stored = localStorage.getItem('familyTreeData');
  
  if (!stored || stored === '[]' || JSON.parse(stored).length === 0) {
    console.log("üì• localStorage –ø—É—Å—Ç, –≥—Ä—É–∑–∏–º —Å GitHub...");
    
    try {
      const url = '/all_family-tree_finish/data/family-data.json';
      console.log("üì° –ó–∞–ø—Ä–æ—Å:", url);
      
      const response = await fetch(url);
      console.log("üìä –°—Ç–∞—Ç—É—Å:", response.status);
      
      if (response.ok) {
        const data = await response.json();
        console.log("‚úÖ –ü–æ–ª—É—á–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π:", data.length);
        
        if (data && data.length > 0) {
          localStorage.setItem('familyTreeData', JSON.stringify(data));
          window.people = data;
          
          // –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ app.js
          setTimeout(() => {
            if (typeof window.refreshAll === 'function') {
              window.refreshAll();
              console.log("‚úÖ –ì—Ä–∞—Ñ–∏–∫ –æ–±–Ω–æ–≤–ª—ë–Ω!");
            }
          }, 1000);
        }
      } else {
        console.error("‚ùå HTTP", response.status, response.statusText);
      }
    } catch (err) {
      console.error("‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏:", err);
    }
  } else {
    console.log("‚úÖ –î–∞–Ω–Ω—ã–µ —É–∂–µ –≤ localStorage:", JSON.parse(stored).length);
  }
})();
</script>
  <!-- –§—É–Ω–∫—Ü–∏—è —Ä–µ—Ñ—Ä–µ—à –¥–µ—Ä–µ–≤–∞ -->
  <script>
    window.refreshTreeData = function() {
      console.log("üîÑ –†–µ—Ñ—Ä–µ—à –¥–µ—Ä–µ–≤–∞...");
      
      // –û—á–∏—â–∞–µ–º SVG
      if (typeof d3 !== 'undefined') {
        d3.select("#tree-svg").selectAll("*").remove();
      }
      
      // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
      const data = JSON.parse(localStorage.getItem('familyTreeData') || '[]');
      window.people = data;
      
      // –†–µ–Ω–¥–µ—Ä–∏–º –¥–µ—Ä–µ–≤–æ –∑–∞–Ω–æ–≤–æ
      if (window.familyTree && typeof window.familyTree.render === 'function') {
        window.familyTree.render();
        console.log("‚úÖ –î–µ—Ä–µ–≤–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!");
      } else {
        console.log("‚ö†Ô∏è –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã...");
        location.reload();
      }
    };
  </script>
</body>
</html>


